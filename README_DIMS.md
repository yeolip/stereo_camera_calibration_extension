# 3차원 차량 내부 공간과 설치 카메라간 위치관계

실행방법1 - 최종계산

python camera_calibrate_input_rms_ext_dims.py <실행위치> <Calib file.json> <2d_3d points.csv>

예제
python camera_calibrate_input_rms_ext_dims.py ./ ./dims_example/stereo_config_instrinsic_camX.json ./dims_example

결과
result222 =
[[ 1.90155942e-01 -2.74907551e-01  2.55830624e-01  1.00000000e+00]
 [-2.75494610e-01 -3.25556077e-01  2.00568993e-01  1.00000000e+00]
 [ 2.28470806e-01 -2.63130238e-01  1.54513334e-01  1.00000000e+00]
 [-2.95876165e-01 -3.16857339e-01  4.43295683e-02  1.00000000e+00]
 [ 2.53466100e-01 -2.49693550e-01  3.36139067e-02  1.00000000e+00]
 [-3.15306820e-01 -2.98995949e-01 -1.53969258e-01  1.00000000e+00]
 [ 2.79191300e-01 -2.30391235e-01 -1.11840744e-01  1.00000000e+00]
 [-3.35864212e-01 -2.73254445e-01 -3.44924341e-01  1.00000000e+00]
 [ 2.77780812e-01 -2.63359000e-01 -3.41416670e-01  1.00000000e+00]
 [ 8.32078072e-02 -2.93557014e-01  2.34330589e-01  1.00000000e+00]
 [ 1.29379903e-01 -2.63760485e-01 -3.45388267e-01  1.00000000e+00]
 [-4.07813488e-02 -3.09008964e-01  2.14753416e-01  1.00000000e+00]
 [ 3.90922505e-03 -2.66119577e-01 -3.60489356e-01  1.00000000e+00]
 [-1.67872885e-01 -3.19634077e-01  2.04608898e-01  1.00000000e+00]
 [-1.91505500e-01 -2.70300219e-01 -3.56940040e-01  1.00000000e+00]
 [ 1.99119358e-01 -1.98120534e-01  3.43709052e-01  1.00000000e+00]
 [-3.89067301e-01 -2.45199363e-01  3.70401726e-01  1.00000000e+00]
 [ 2.57242829e-01 -1.63958432e-01  7.55278642e-02  1.00000000e+00]
 [-3.87524829e-01 -3.12628024e-01 -3.62492371e-02  1.00000000e+00]
 [ 2.93795765e-01 -1.33523542e-01 -1.59736550e-01  1.00000000e+00]
 [-3.91894935e-01 -1.63753770e-01 -1.23777914e-01  1.00000000e+00]
 [-7.00845846e-01 -3.05428416e-01 -3.84659902e-02  1.00000000e+00]
 [-2.01361770e-01 -1.46188447e-01 -1.28769799e-01  1.00000000e+00]
 [-2.05989120e-01 -2.45909289e-01  3.72975921e-01  1.00000000e+00]
 [-8.15650608e-02 -1.63703340e-01 -8.90996622e-02  1.00000000e+00]
 [-4.38700955e-02 -2.33709647e-01  3.87651247e-01  1.00000000e+00]
 [ 9.98065989e-02 -1.55655701e-01 -9.51607115e-02  1.00000000e+00]
 [ 1.66736494e-01 -2.44933350e-01  3.71183057e-01  1.00000000e+00]
 [ 2.18843953e-01 -1.09772874e-01 -1.28617937e-01  1.00000000e+00]
 [ 2.29146092e-01 -4.90651245e-01 -1.17842337e+00  1.00000000e+00]
 [-2.97057580e-02 -5.00195575e-01 -1.18159295e+00  1.00000000e+00]
 [-3.09592121e-01 -5.19399346e-01 -1.17951548e+00  1.00000000e+00]
 [ 6.12358957e-01 -1.37357313e-01  5.99650456e-02  1.00000000e+00]
 [ 4.87379286e-01 -1.64771212e-01  2.64293796e-02  1.00000000e+00]
 [ 6.34903840e-01 -5.34175567e-02  4.23231336e-02  1.00000000e+00]
 [ 5.19130168e-01 -6.14228283e-02  1.02849510e-02  1.00000000e+00]
 [ 5.56967975e-01 -1.09648265e-01  3.69996824e-02  1.00000000e+00]
 [-1.25475091e+00 -1.86348746e-01  2.70255257e-02  1.00000000e+00]
 [-1.36104858e+00 -1.57286975e-01  8.58286082e-02  1.00000000e+00]
 [-1.28193240e+00 -8.62125963e-02  1.22053879e-02  1.00000000e+00]
 [-1.38266950e+00 -7.24515895e-02  6.83580698e-02  1.00000000e+00]
 [-1.31911236e+00 -1.25982800e-01  5.09418986e-02  1.00000000e+00]
 [ 1.44453971e-01 -8.11341036e-02 -1.56475107e-01  1.00000000e+00]
 [ 1.24391742e-01 -5.06897260e-03 -1.98907672e-01  1.00000000e+00]
 [ 3.08371437e-03 -1.07047230e-01 -1.32391202e-01  1.00000000e+00]
 [ 1.14785912e-03 -7.08264770e-03 -1.97646693e-01  1.00000000e+00]
 [-1.41756539e-01 -8.13793992e-02 -1.60808693e-01  1.00000000e+00]
 [-1.21589251e-01 -2.21470295e-03 -1.97806331e-01  1.00000000e+00]
 [-5.18023315e-01 -9.63066004e-02 -7.32351181e-02  1.00000000e+00]
 [-5.08346886e-01  2.21770052e-02 -3.35293968e-02  1.00000000e+00]
 [-3.91116422e-01 -1.21017650e-01 -6.05384126e-02  1.00000000e+00]
 [-4.02031175e-01  2.14294772e-02 -3.83640808e-02  1.00000000e+00]
 [-2.83337204e-01 -9.85225118e-02 -8.95287567e-02  1.00000000e+00]
 [-2.82837542e-01  1.89439316e-02 -5.51987353e-02  1.00000000e+00]
 [-2.60767261e-01 -2.74854418e-01  2.21230285e-01  1.00000000e+00]
 [-4.78072670e-01 -2.58702875e-01  2.60569685e-01  1.00000000e+00]
 [-2.55797316e-01 -2.25427597e-01  1.97554075e-01  1.00000000e+00]
 [-4.87810372e-01 -2.04998069e-01  2.34537133e-01  1.00000000e+00]
 [-4.94268483e-01  3.99704768e-03 -8.34206451e-02  1.00000000e+00]]
1st 0.29078192

계산순서

Step_One
 1. Get camera calibration parameter from installed camera
       (카메라의 특성 추출) <BR>
    가. Stereo json format에 camera의 intrinsic을 갱신하여 작업         


Step_Two
2. Load and transform 3d point on world coordinate based on reference points coordinate 
       (기준이 되는 좌표 기준, 3차원 공간상의 점 변환) <BR>
	나. https://github.com/yeolip/auto_position_recovery.git <BR>
		branch - for_dims
		recovery_dims_icc.py 실행

		1. Tab클릭 - Method_Five
		2. File - Load Data - 파일 선택 - PointData_ICMU_In-lab1_GazePoints_20240326.txt
		3. Sorting할 group선택 - ABS2 
		4. Button - Running_Result
		5. File - Save Data - 파일 저장

Step_Three
3. Calculate same chart position on 2D and 3D
       (차트의 위치 정보 계산, 3차원 공간, 2차원 위치) <BR>
	다. 	https://github.com/yeolip/auto_position_recovery.git <BR>
		branch - for_dims
		recovery_dims_icc.py 실행

		1. Tab클릭 - Method_Five
		2. File - Load Data - 파일 선택 - PointData_ICMU_In-lab1_물방울차트_20240326.txt
		3. Sorting할 group선택 - ABS2 
		4. Button - Running_Result
		5. File - Save Data - 파일 저장
        >
    라. https://github.com/yeolip/stereo_camera_calibration_extension <BR>
		branch - for_dims
		camera_calibrate_input_rms_ext_dims.py 실행
		
		1. <Image가 존재하는 path에서 ./LEFT폴더와 ./RIGHT폴더를 만들고, 동일한 Image를 두 폴더안에 복사한다.
		   그후 ./LEFT와 ./RIGHT폴더의 상위폴더를 image path로 잡아준다.
		   python camera_calibrate_input_rms_ext_dims.py <image path> 
		2. 차트가 인식이 되면, p_from_img000.csv가 생성됨
		3. p_from_image000.csv에서 A,B,C열의 좌표를 auto_position_recovery 툴로 도출된 #다 결과좌표로 갱신해준다.
			
Step_Four
4. Calculate 3D distance RT from camera to target point
       (카메라로 부터 3차원 공간상의 점까지의 위치관계 추출)

	마. 	https://github.com/yeolip/stereo_camera_calibration_extension
		branch - for_dims
		camera_calibrate_input_rms_ext_dims.py 실행

		코드안에 def calc_rms_stereo2 함수아래, test222변수에 #나 결과 좌표를 넣어준다.
			형식 [x,y,z,1],
		python camera_calibrate_input_rms_ext_dims.py <실행위치> <Calib file.json> <2d_3d points.csv>
		python camera_calibrate_input_rms_ext_dims.py ./ ./dims_example/stereo_config_instrinsic_camX.json ./dims_example
